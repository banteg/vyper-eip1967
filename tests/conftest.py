import pytest
from ethpm_types import Bytecode


@pytest.fixture
def dev(accounts):
    return accounts[0]


@pytest.fixture
def alice(accounts):
    return accounts[1]


@pytest.fixture
def implementation(project, dev):
    return project.Implementation.deploy(sender=dev)


@pytest.fixture
def implementation_v2(project, dev):
    return project.Implementation_v2.deploy(sender=dev)


@pytest.fixture
def proxy(project, implementation, dev):
    """
    FIXME since neither of vyper, vvm, ape-vyper provide a way to pass the custom layout option,
    we patch the init code with the output of this command:

    vyper --storage-layout-file=custom_storage.json contracts/Proxy.vy
    """
    init_code = "0x60206102b05f395f518060a01c6102ac57604052346102ac576040517f360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc55337fb53127684a568b3173ae13b9f8a6016e243e63b6e8ee1178d6a717850b5d61035561023961007261000039610239610000f36003361161000c576101bd565b5f3560e01c3461022857635c60da1b811861004c577f360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc5460405260206040f35b63f851a4408118610082577fb53127684a568b3173ae13b9f8a6016e243e63b6e8ee1178d6a717850b5d61035460405260206040f35b633c436f25811861011a5760243610610228576004358060a01c610228576040527fb53127684a568b3173ae13b9f8a6016e243e63b6e8ee1178d6a717850b5d6103543318610228576040517f360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc556040517fbc7cd75a20ee27fd9adebab32041f755214dbc6bffa90cc0225b39da2e5c2d3b5f6060a2005b63158686b581186101bb5760243610610228576004358060a01c610228576040527fb53127684a568b3173ae13b9f8a6016e243e63b6e8ee1178d6a717850b5d6103546060526060513318610228576040517fb53127684a568b3173ae13b9f8a6016e243e63b6e8ee1178d6a717850b5d6103556040516060517f7e644d79422f17c01e4894b5f4f588d331ebfa28653d42ae832dc59e38c9798f5f6080a3005b505b3461022857596020608036365f8537837f360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc545af490506101ff573d5f5f3e3d5ffd5b3d602081183d602010021860605260606020810151815160200360031b1c905060405260206040f35b5f80fda165767970657283000309000b005b5f80fd"
    project.Proxy.contract_type.deployment_bytecode = Bytecode(bytecode=init_code)

    return project.Proxy.deploy(implementation, sender=dev)
